import{r as t,j as s}from"./index-Bv95bFYi.js";import{c as H,a as b}from"./helper-CaAdfMs7.js";import{u as k,g as y}from"./viewport-Cdg5FG6T.js";import"./request-BaIgPWdV.js";import{s as N}from"./spring-BiPrtYZ-.js";import{m as T}from"./motion-minimal-Dou77nS9.js";import{u as C}from"./use-event-callback-mZpuvDyq.js";import{s as R}from"./dom-XXNktKeO.js";import{t as E}from"./toast-DcnsCoJV.js";import{M as L}from"./StyledButton-UszMzkUx.js";const z=({children:r,className:c,duration:o=.6,spring:n=!1})=>{const a=t.useRef(null),[d,l]=t.useState("auto");return t.useEffect(()=>{if(a.current){const m=new ResizeObserver(h=>{const p=h[0].contentRect.height;l(p)});return m.observe(a.current),()=>{m.disconnect()}}},[]),s.jsx(T.div,{className:H("overflow-hidden",c),style:{height:d},initial:!1,animate:{height:d},transition:n?N:{duration:o},children:s.jsx("div",{ref:a,children:r})})},j=0,_=({ref:r,size:c="base",element:o,selector:n}={})=>{const a=t.useRef(null),[d,l]=t.useState(!1),[m,h]=t.useState(!1),[p,f]=t.useState(!1),g=k(e=>e.h),i=t.useCallback(()=>{let e=a.current||r?.current||o;if(e)return n&&(e=e.querySelector(n)),e},[r,n,o]),u=C(()=>{const e=i();if(!e)return;if(e.scrollHeight<=e.clientHeight+2){f(!1),l(!1),h(!1);return}f(!0);const S=e.scrollTop+e.clientHeight>=e.scrollHeight-j,v=e.scrollTop<=j;l(S),h(v)});t.useEffect(()=>{const e=i();if(e)return e.addEventListener("scroll",u),()=>{e.removeEventListener("scroll",u)}},[u,i,o]),t.useEffect(()=>{u()},[u,g,o]);const x={base:"",lg:"-lg"}[c];return[a,p?b(d&&"mask-t",m&&"mask-b",!d&&!m&&"mask-both")+x:""]},w={"code-card":"_code-card_13eh4_1","scroll-container":"_scroll-container_13eh4_77"},$=r=>{const c=r.match(/filename="([^"]+)"/);return c?c[1]:null},G=r=>["javascript","typescript","ts","js","css","tsx","jsx","json","sql","markdown","vue","rust","go","cpp","c","html","asm","bash","ps","ps1","text","plaintext","txt","plain"].includes(r.toLowerCase()),B=t.forwardRef((r,c)=>{const{lang:o,content:n,attrs:a}=r,d=t.useCallback(()=>{navigator.clipboard.writeText(n),E.success("已复制到剪贴板")},[n]),[l,m]=t.useState(null);t.useImperativeHandle(c,()=>l);const[h,p]=t.useState(!0),[f,g]=t.useState(!1);t.useEffect(()=>{const e=l;if(!e)return;const v=y().h/2;e.scrollHeight>=v?(g(!0),e.querySelector(".highlighted")?.scrollIntoView({block:"center"})):g(!1)},[n,l]);const i=t.useMemo(()=>$(a||""),[a]),[,u]=_({element:l,size:"lg"}),x=!!i;return s.jsxs("div",{className:b(w["code-card"],"group"),onCopy:R,children:[!!i&&s.jsxs("div",{className:"z-10 flex w-full items-center justify-between rounded-t-xl bg-accent/20 px-5 py-2 text-sm",children:[s.jsx("span",{className:"shrink-0 grow truncate",children:i}),s.jsx("span",{className:"pointer-events-none shrink-0 grow-0","aria-hidden":!0,children:o?.toUpperCase()})]}),!i&&!!o&&s.jsx("div",{"aria-hidden":!0,className:"pointer-events-none absolute bottom-3 right-3 z-10 text-sm opacity-60",children:o.toUpperCase()}),s.jsxs("div",{className:"bg-accent/5 py-4",children:[s.jsx(L,{onClick:d,className:b("absolute right-2 top-2 z-[1] flex text-xs center","rounded-md border border-accent/5 bg-accent/80 p-1.5 text-white backdrop-blur duration-200","opacity-0 group-hover:opacity-100",i&&"!top-12"),children:s.jsx("i",{className:"icon-[mingcute--copy-2-fill] size-4"})}),s.jsxs(z,{spring:!0,className:"relative",children:[s.jsx("div",{ref:m,className:H("relative max-h-[50vh] w-full overflow-auto",h?f?u:"":"!max-h-full",w["scroll-container"]),style:{"--sr-margin":x?"1rem":`${(o?.length||0)*14+4}px`},dangerouslySetInnerHTML:r.renderedHTML?{__html:r.renderedHTML}:void 0,children:r.children}),f&&h&&s.jsx("div",{className:`absolute inset-x-0 bottom-0 flex justify-center py-2 duration-200 ${["mask-both-lg","mask-b-lg"].includes(u)?"":"pointer-events-none opacity-0"}`,children:s.jsxs("button",{onClick:()=>p(!1),"aria-hidden":!0,className:"flex items-center justify-center text-xs",children:[s.jsx("i",{className:"icon-[mingcute--arrow-to-down-line]"}),s.jsx("span",{className:"ml-2",children:"展开"})]})})]})]})]})});B.displayName="ShikiHighLighterWrapper";export{z as A,B as S,G as i};
